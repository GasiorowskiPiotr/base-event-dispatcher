var evilduck;!function(t){var e=function(){function t(){}return t.prototype.map=function(){throw new Error("Not implemented")},t.prototype.union=function(){throw new Error("Not implemented")},t.prototype.find=function(){throw new Error("Not implemented")},t.prototype.indexOf=function(){throw new Error("Not implemented")},t.prototype.filter=function(){throw new Error("Not implemented")},t}();t.CollWrapper=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function e(t,e){this._innerDict={},this.$q=t,this.coll=e}return e.prototype.on=function(e,n,i){if(void 0===i&&(i=null),!e)throw new Error("Event name must not be empty");if(!n)throw new Error("Handler must be defined");this._innerDict[e]||(this._innerDict[e]=new t.EventSubscription(e,this.$q,this.coll));var r=this._innerDict[e].subscribe(n,i);return r.Dispatcher=this,r},e.prototype.unsubscribe=function(t,e,n){void 0===n&&(n=null),this._innerDict[e]&&(this._innerDict[e].unsubscribe(t,n),0===this._innerDict[e].count&&delete this._innerDict[e])},e.prototype.dispatch=function(t,e,n){return void 0===n&&(n=null),this._innerDict[e]?this._innerDict[e].wrap(t,n):this.$q.when()},e}();t.EventDispatcher=e;var n=function(){function t(t,e,n){void 0===n&&(n=null),this.event=e,this.tag=n,this.isDestroyed=!1}return t.prototype.destroy=function(){this.isDestroyed||(this.dispatcher.unsubscribe(this.guid,this.event,this.tag),this.isDestroyed=!0)},Object.defineProperty(t.prototype,"Dispatcher",{get:function(){return this.dispatcher},set:function(t){this.dispatcher=t},enumerable:!0,configurable:!0}),t}();t.SubscriptionInfo=n}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function e(t,e,n){this._eventName=t,this._tagSubs=new Array,this._subs=new Array,this._q=e,this._coll=n}return Object.defineProperty(e.prototype,"eventName",{get:function(){return this._eventName},enumerable:!0,configurable:!0}),e.prototype.subscribe=function(t,e){return void 0===e&&(e=null),this.subscribeGeneral(t,e)},e.prototype.subscribeGeneral=function(e,n){void 0===n&&(n=null);var i=this.createGuid();return n?(this._tagSubs.push(t.TagSubscription.General(n,e,i)),new t.SubscriptionInfo(i,this._eventName,n)):(this._subs.push(new t.InnerSubscription(e,i)),new t.SubscriptionInfo(i,this._eventName))},e.prototype.wrap=function(t,e){var n=this;void 0===e&&(e=null);var i,r;e?(i=new Array,r=this._coll.filter(this._tagSubs,function(t){return t.tagName===e})):(i=this._subs,r=this._tagSubs);var o=this._coll.union(i,r);if(0==o.length)return this._q.when();var u=this._coll.map(o,function(e){return e.wrap(n._q,t)});return this._q.all(u)},e.prototype.unsubscribe=function(t,e){if(void 0===e&&(e=null),e){var n=this._coll.find(this._tagSubs,function(n){return n.tagName===e&&n.guid===t}),i=this._coll.indexOf(this._tagSubs,n);this._tagSubs.splice(i,1)}else{var r=this._coll.find(this._subs,function(e){return e.guid===t}),o=this._coll.indexOf(this._subs,r);this._subs.splice(o,1)}},Object.defineProperty(e.prototype,"count",{get:function(){return this._subs.length+this._tagSubs.length},enumerable:!0,configurable:!0}),e.prototype.createGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)})},e}();t.EventSubscription=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function t(t,e){void 0===e&&(e=null),this._func=t,this._guid=e}return t.prototype.wrap=function(t,e){return t.when(this._func(e))},Object.defineProperty(t.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),t}();t.InnerSubscription=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function t(){}return t.prototype.then=function(){throw new Error("Not implemented")},t.prototype.catch=function(){throw new Error("Not implemented")},t.prototype.finally=function(){throw new Error("Not implemented")},t}();t.PromiseWrapper=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function t(){}return t.prototype.when=function(t){throw void 0===t&&(t=null),new Error("Not implemented")},t.prototype.all=function(){throw new Error("Not implemented")},t}();t.QWrapper=e}(evilduck||(evilduck={}));var evilduck;!function(t){var e=function(){function e(){}return e.General=function(n,i,r){void 0===r&&(r=null);var o=new e;return o._sub=new t.InnerSubscription(i,r),o._tagName=n,o},Object.defineProperty(e.prototype,"tagName",{get:function(){return this._tagName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"subscription",{get:function(){return this._sub},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"guid",{get:function(){return this._guid},enumerable:!0,configurable:!0}),e.prototype.wrap=function(t,e){return this._sub.wrap(t,e)},e}();t.TagSubscription=e}(evilduck||(evilduck={}));